<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todolist</title>
  <link rel="stylesheet" href="todolist.css">
  <script>
    // window.addEventListener('load', function() {
    //   alert('è®¿å®¢+1')
    // })
    // window.addEventListener('beforeunload', function() {
    //   alert('å…³é—­é¡µé¢äº†')
    // })
    // åˆ¤æ–­æµè§ˆå™¨å†…æ ¸ 
    if (navigator.userAgent.toLowerCase().indexOf('chrome') === -1) {
      alert('ä¸ºä¿è¯æ‚¨çš„ä½¿ç”¨ä½“éªŒï¼Œè¯·ä¸‹è½½è°·æ­Œæµè§ˆå™¨')
      location.href = 'https://www.google.cn/chrome/'
    }
  </script>
</head>
<body>
  <div class="todo">
    <div class="box">
      <!-- æ ‡é¢˜ -->
      <p class="tit">å¤‡å¿˜å½•ï¼š</p>
      <!-- æ·»åŠ æŒ‰é’®åŠå…¶è¾“å…¥æ¡† -->
      <div class="action">
        <input type="text" name="task" autocomplete="off" placeholder="è¯·å¡«å†™å†…å®¹">
        <button class="add">æ·»åŠ </button>
      </div>
      <!-- å¤‡å¿˜å½•åˆ—è¡¨ -->
      <ul class="list">
        <li class="item">
          <span class="info">å‘¨ä¸€æ—©ä¸Šä¾‹ä¼š</span>
          <div class="control">
            <button class="edit">ç¼–è¾‘</button>
            <button class="finish">å®Œæˆ</button>
            <button class="delete">åˆ é™¤</button>
          </div>
        </li>
        <li class="item">
          <span class="info">å‘¨äºŒæ™šä¸ŠåŠ ç­</span>
          <div class="control">
            <button class="edit">ç¼–è¾‘</button>
            <button class="finish">å®Œæˆ</button>
            <button class="delete">åˆ é™¤</button>
          </div>
        </li>
      </ul>
    </div>
    <img class="backTop" src="./imgs/backtop.svg" alt="è¿”å›é¡¶éƒ¨">
  </div>
</body>
<script>
  // æ·»åŠ 
  var input = document.querySelector('.action input')
  var addBtn = document.querySelector('.add')
  var list = document.querySelector('.list')
  var backTop = document.querySelector('.backTop')

  // è®¾ç½®è¿”å›é¡¶éƒ¨å›¾æ ‡
  window.addEventListener('scroll', function() {
    var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop
    if (scrollTop > 200) {
      backTop.style.display = 'block'
    } else {
      backTop.style.display = 'none'
    }
  })

  // è¿”å›é¡¶éƒ¨
  backTop.addEventListener('click', function() {
    var timer = setInterval(function() {
      var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop
      if (scrollTop === 0) {
        clearInterval(timer)
      }

      scrollBy(0, -20)
    }, 5)
  })

  // å›è½¦æ·»åŠ 
  input.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      addAction()
    }
  })

  addBtn.addEventListener('click', addAction)

  // æ·»åŠ åŠ¨ä½œ
  function addAction() {
    list.insertAdjacentHTML('beforeend', `
    <li class="item">
      <span class="info">${input.value}</span>
      <div class="control">
        <button class="edit">ç¼–è¾‘</button>
        <button class="finish">å®Œæˆ</button>
        <button class="delete">åˆ é™¤</button>
      </div>
    </li>
    `)

    list.lastElementChild.querySelector('.delete').addEventListener('click', function() {
      list.removeChild(this.parentNode.parentNode)
    })
    list.lastElementChild.querySelector('.finish').addEventListener('click', function() {
      var listItem = this.parentNode.parentNode
      listItem.classList.add('finished')
    })
    list.lastElementChild.querySelector('.edit').addEventListener('click', function() {
      var listItem = this.parentNode.parentNode
      listItem.querySelector('.info').innerText = prompt('è¯·è¾“å…¥ä¿®æ”¹å†…å®¹ğŸ˜€')
    })
    list.lastElementChild.addEventListener('dblclick', function() {
      this.querySelector('.info').innerText = prompt('è¯·è¾“å…¥ä¿®æ”¹å†…å®¹ğŸ˜€')
    })
    
    list.lastElementChild.addEventListener('mouseenter', function() {
      this.classList.add('active')
    })
    list.lastElementChild.addEventListener('mouseleave', function() {
      this.classList.remove('active')
    })
  }

  // åˆ é™¤
  var delBtns = document.querySelectorAll('.delete')
  // å®Œæˆ
  var finishBtns = document.querySelectorAll('.finish')
  // ç¼–è¾‘
  var editBtns = document.querySelectorAll('.edit')
  
  for (let idx = 0; idx < delBtns.length; idx++) {
    // åˆ é™¤åŠ¨ä½œ
    delBtns[idx].addEventListener('click', function() {
      list.removeChild(this.parentNode.parentNode)
    })
    // å®ŒæˆåŠ¨ä½œ
    finishBtns[idx].addEventListener('click', function() {
      var listItem = this.parentNode.parentNode
      // listItem.style.backgroundColor = '#a5f1b8'
      listItem.classList.add('finished')
    })
    // ç¼–è¾‘åŠ¨ä½œ
    editBtns[idx].addEventListener('click', function() {
      var listItem = this.parentNode.parentNode
      listItem.querySelector('.info').innerText = prompt('è¯·è¾“å…¥ä¿®æ”¹å†…å®¹ğŸ˜€')
    })
    // åŒå‡»ç¼–è¾‘
    list.children[idx].addEventListener('dblclick', function() {
      this.querySelector('.info').innerText = prompt('è¯·è¾“å…¥ä¿®æ”¹å†…å®¹ğŸ˜€')
    })
    // é¼ æ ‡ç§»å…¥
    list.children[idx].addEventListener('mouseenter', function() {
      this.classList.add('active')
    })
    // é¼ æ ‡ç§»å‡º
    list.children[idx].addEventListener('mouseleave', function() {
      this.classList.remove('active')
    })
  }
</script>
</html>